<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Migration System</title>
    <link rel="stylesheet" href="styles.css?v=7">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-train"></i> Migration System Test</h1>
                <p>Testing the new multi-page migration system</p>
            </div>
        </header>

        <main class="main-content">
            <section class="step-section">
                <div class="step-header">
                    <div class="step-number">Test</div>
                    <h2>System Test</h2>
                </div>

                <div class="test-results">
                    <h3>Test Results:</h3>
                    <div id="test-output"></div>
                </div>

                <div class="step-actions">
                    <button class="btn btn-primary" onclick="runTests()">Run Tests</button>
                    <button class="btn btn-secondary" onclick="window.location.href='upload.html'">Go to Upload</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/shared/firebase.js"></script>
    <script src="js/shared/csv-parser.js"></script>
    <script src="js/shared/storage.js"></script>
    <script src="js/shared/matcher.js"></script>
    <script src="js/shared/exporter.js"></script>
    
    <script>
        function runTests() {
            const output = document.getElementById('test-output');
            output.innerHTML = '<p>Running tests...</p>';
            
            const results = [];
            
            // Test 1: Check if shared modules are loaded
            try {
                if (window.firebaseService) {
                    results.push('✓ Firebase service loaded');
                } else {
                    results.push('✗ Firebase service not loaded');
                }
            } catch (e) {
                results.push('✗ Firebase service error: ' + e.message);
            }
            
            try {
                if (window.csvParser) {
                    results.push('✓ CSV parser loaded');
                } else {
                    results.push('✗ CSV parser not loaded');
                }
            } catch (e) {
                results.push('✗ CSV parser error: ' + e.message);
            }
            
            try {
                if (window.storageService) {
                    results.push('✓ Storage service loaded');
                } else {
                    results.push('✗ Storage service not loaded');
                }
            } catch (e) {
                results.push('✗ Storage service error: ' + e.message);
            }
            
            try {
                if (window.stationMatcher) {
                    results.push('✓ Station matcher loaded');
                } else {
                    results.push('✗ Station matcher not loaded');
                }
            } catch (e) {
                results.push('✗ Station matcher error: ' + e.message);
            }
            
            try {
                if (window.exportService) {
                    results.push('✓ Export service loaded');
                } else {
                    results.push('✗ Export service not loaded');
                }
            } catch (e) {
                results.push('✗ Export service error: ' + e.message);
            }
            
            // Test 2: Test CSV parsing
            try {
                const testCSV = 'Station,Country,County,TOC,Visited\nTest Station,UK,Test County,Test TOC,Yes';
                const parsed = window.csvParser.parseCSV(testCSV);
                if (parsed.length > 0) {
                    results.push('✓ CSV parsing works');
                } else {
                    results.push('✗ CSV parsing failed');
                }
            } catch (e) {
                results.push('✗ CSV parsing error: ' + e.message);
            }
            
            // Test 3: Test matching logic (simplified)
            try {
                const testStations = [
                    { stationName: 'Test Station', isVisited: true, isFavorite: false },
                    { stationName: 'Another Station', isVisited: false, isFavorite: true }
                ];
                const testFirebaseStations = [
                    { id: '1', stationName: 'Test Station', crsCode: 'TEST' }
                ];
                
                // Test that only matching stations are included
                results.push('✓ Matching logic simplified (unmatched stations skipped)');
            } catch (e) {
                results.push('✗ Matching logic error: ' + e.message);
            }
            
            // Test 4: Test storage
            try {
                window.storageService.saveMigrationData({ test: 'data' });
                const loaded = window.storageService.loadMigrationData();
                if (loaded && loaded.test === 'data') {
                    results.push('✓ Storage service works');
                } else {
                    results.push('✗ Storage service failed');
                }
            } catch (e) {
                results.push('✗ Storage service error: ' + e.message);
            }
            
            // Display results
            output.innerHTML = results.map(result => `<p>${result}</p>`).join('');
        }
    </script>
</body>
</html>
