<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; font-src 'self' data: https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; script-src 'self' 'unsafe-inline' https://www.gstatic.com; img-src 'self' data:; connect-src 'self' https://*.firebaseio.com https://*.googleapis.com;">
    <title>Simplified CSV Parser Test</title>
    <link rel="stylesheet" href="styles.css?v=7">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-vial"></i> Simplified CSV Parser Test</h1>
                <p>Test the simplified CSV parser with essential fields only</p>
            </div>
        </header>

        <main class="main-content">
            <section class="step-section">
                <div class="step-header">
                    <div class="step-number">Test</div>
                    <h2>CSV Parser Test Results</h2>
                </div>

                <div class="debug-results">
                    <h3>Test Results:</h3>
                    <div id="test-output"></div>
                </div>

                <div class="step-actions">
                    <button class="btn btn-primary" onclick="runParserTests()">Run Parser Tests</button>
                    <button class="btn btn-secondary" onclick="window.location.href='upload.html'">Back to Upload</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/shared/csv-parser.js"></script>
    
    <script>
        function runParserTests() {
            const output = document.getElementById('test-output');
            output.innerHTML = '<p>Running parser tests...</p>';
            
            const results = [];
            
            // Test 1: Basic CSV with essential fields
            try {
                const testCSV1 = `Station Name,Visited,Visit Date,Favorite
London Bridge,Yes,15/03/2023,Yes
Manchester Piccadilly,No,,No
Birmingham New Street,Yes,22/07/2023;10/12/2023,Yes`;
                
                const stations1 = window.csvParser.parseCSV(testCSV1);
                results.push(`✓ Basic CSV test: ${stations1.length} stations parsed`);
                
                if (stations1.length === 3) {
                    const station1 = stations1[0];
                    if (station1.stationName === 'London Bridge' && station1.isVisited === true && station1.isFavorite === true) {
                        results.push('✓ Station 1 data correct');
                    } else {
                        results.push('✗ Station 1 data incorrect');
                    }
                    
                    const station2 = stations1[1];
                    if (station2.stationName === 'Manchester Piccadilly' && station2.isVisited === false && station2.isFavorite === false) {
                        results.push('✓ Station 2 data correct');
                    } else {
                        results.push('✗ Station 2 data incorrect');
                    }
                    
                    const station3 = stations1[2];
                    if (station3.stationName === 'Birmingham New Street' && station3.visitedDates.length === 2) {
                        results.push('✓ Station 3 with multiple dates correct');
                    } else {
                        results.push('✗ Station 3 data incorrect');
                    }
                } else {
                    results.push('✗ Expected 3 stations, got ' + stations1.length);
                }
                
            } catch (e) {
                results.push('✗ Basic CSV test error: ' + e.message);
            }
            
            // Test 2: CSV with different column names
            try {
                const testCSV2 = `station,visited,visit date dd/mm/yyyy,favourite
Edinburgh Waverley,1,05/01/2023,1
Glasgow Central,0,,0`;
                
                const stations2 = window.csvParser.parseCSV(testCSV2);
                results.push(`✓ Alternative column names test: ${stations2.length} stations parsed`);
                
                if (stations2.length === 2) {
                    const station1 = stations2[0];
                    if (station1.stationName === 'Edinburgh Waverley' && station1.isVisited === true && station1.isFavorite === true) {
                        results.push('✓ Alternative column names work correctly');
                    } else {
                        results.push('✗ Alternative column names failed');
                    }
                }
                
            } catch (e) {
                results.push('✗ Alternative column names test error: ' + e.message);
            }
            
            // Test 3: CSV with missing optional fields
            try {
                const testCSV3 = `Station Name,Visited
Paddington,Yes
King's Cross,No`;
                
                const stations3 = window.csvParser.parseCSV(testCSV3);
                results.push(`✓ Missing optional fields test: ${stations3.length} stations parsed`);
                
                if (stations3.length === 2) {
                    const station1 = stations3[0];
                    if (station1.stationName === 'Paddington' && station1.isVisited === true && station1.isFavorite === false) {
                        results.push('✓ Missing optional fields handled correctly');
                    } else {
                        results.push('✗ Missing optional fields not handled correctly');
                    }
                }
                
            } catch (e) {
                results.push('✗ Missing optional fields test error: ' + e.message);
            }
            
            // Test 4: CSV with additional matching fields
            try {
                const testCSV4 = `Station Name,Country,County,TOC,Visited,Visit Date,Favorite
London Bridge,England,Greater London,Network Rail,Yes,15/03/2023,Yes
Manchester Piccadilly,England,Greater Manchester,Network Rail,No,,No
Birmingham New Street,England,West Midlands,Network Rail,Yes,22/07/2023,Yes`;
                
                const stations4 = window.csvParser.parseCSV(testCSV4);
                results.push(`✓ Additional matching fields test: ${stations4.length} stations parsed`);
                
                if (stations4.length === 3) {
                    const station1 = stations4[0];
                    if (station1.stationName === 'London Bridge' && 
                        station1.country === 'England' && 
                        station1.county === 'Greater London' && 
                        station1.toc === 'Network Rail' &&
                        station1.isVisited === true && 
                        station1.isFavorite === true) {
                        results.push('✓ Additional matching fields extracted correctly');
                    } else {
                        results.push('✗ Additional matching fields not extracted correctly');
                    }
                }
                
            } catch (e) {
                results.push('✗ Additional matching fields test error: ' + e.message);
            }
            
            // Display results
            output.innerHTML = results.map(result => `<p>${result}</p>`).join('');
        }
    </script>
</body>
</html>
