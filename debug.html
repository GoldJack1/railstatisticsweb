<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Debug</title>
    <link rel="stylesheet" href="styles.css?v=7">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-bug"></i> Firebase Debug</h1>
                <p>Debug Firebase connection issues</p>
            </div>
        </header>

        <main class="main-content">
            <section class="step-section">
                <div class="step-header">
                    <div class="step-number">Debug</div>
                    <h2>Firebase Connection Test</h2>
                </div>

                <div class="debug-results">
                    <h3>Debug Results:</h3>
                    <div id="debug-output"></div>
                </div>

                <div class="step-actions">
                    <button class="btn btn-primary" onclick="runDebugTests()">Run Debug Tests</button>
                    <button class="btn btn-secondary" onclick="window.location.href='upload.html'">Back to Upload</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/shared/firebase.js"></script>
    
    <script>
        function runDebugTests() {
            const output = document.getElementById('debug-output');
            output.innerHTML = '<p>Running debug tests...</p>';
            
            const results = [];
            
            // Test 1: Check if Firebase service is loaded
            try {
                if (window.firebaseService) {
                    results.push('âœ“ Firebase service loaded');
                } else {
                    results.push('âœ— Firebase service not loaded');
                }
            } catch (e) {
                results.push('âœ— Firebase service error: ' + e.message);
            }
            
            // Test 2: Check environment variables
            try {
                const hasApiKey = !!window.VITE_FIREBASE_API_KEY;
                const hasProjectId = !!window.VITE_FIREBASE_PROJECT_ID;
                results.push(`âœ“ Environment variables: API Key=${hasApiKey}, Project ID=${hasProjectId}`);
            } catch (e) {
                results.push('âœ— Environment variables error: ' + e.message);
            }
            
            // Test 3: Try Firebase initialization
            async function testFirebaseInit() {
                try {
                    results.push('ðŸ”„ Testing Firebase initialization...');
                    await window.firebaseService.initialize();
                    results.push('âœ“ Firebase initialization successful');
                    
                    // Test 4: Try fetching stations
                    results.push('ðŸ”„ Testing station fetch...');
                    const stations = await window.firebaseService.fetchStations();
                    results.push(`âœ“ Station fetch successful: ${stations.length} stations loaded`);
                    
                    if (stations.length > 0) {
                        results.push(`âœ“ Sample station: ${stations[0].stationName} (${stations[0].crsCode})`);
                    }
                    
                } catch (error) {
                    results.push(`âœ— Firebase error: ${error.message}`);
                    results.push(`âœ— Error stack: ${error.stack}`);
                }
                
                // Display results
                output.innerHTML = results.map(result => `<p>${result}</p>`).join('');
            }
            
            testFirebaseInit();
        }
    </script>
</body>
</html>
